<div class="chat-container">
  <div class="messages-container" #messagesContainer>
    @if (messages().length === 0) {
      <div class="welcome-message">
        <mat-icon class="welcome-icon">chat</mat-icon>
        <h2>Claude Code Chat</h2>
        <p>Ask me anything about your code!</p>
        @if (claudeAvailable()) {
          <p class="status-text">Claude Code CLI v{{ claudeVersion() }} is ready</p>
        } @else {
          <p class="status-text error">{{ claudeMessage() || 'Claude Code CLI is not available' }}</p>
        }
      </div>
    }
    
    @for (message of messages(); track message.timestamp) {
      <div class="message" [class.user-message]="message.role === 'user'" 
           [class.assistant-message]="message.role === 'assistant'">
        <mat-card class="message-card" appearance="outlined">
          <mat-card-content>
            <div class="message-header">
              <mat-icon class="message-icon">
                {{ message.role === 'user' ? 'person' : 'smart_toy' }}
              </mat-icon>
              <span class="message-role">{{ message.role === 'user' ? 'You' : 'Claude' }}</span>
              @if (message.streaming) {
                <mat-spinner diameter="16" class="streaming-indicator"></mat-spinner>
              }
            </div>
            <div class="message-content" [innerHTML]="message.content | markdown"></div>
          </mat-card-content>
        </mat-card>
      </div>
    }
  </div>

  <div class="input-container">
    <mat-form-field appearance="outline" class="message-input">
      <mat-label>Type your message...</mat-label>
      <textarea
        matInput
        [value]="userInput()"
        (input)="onInputChange($event)"
        (keypress)="onKeyPress($event)"
        [disabled]="isStreaming() || !claudeAvailable()"
        rows="3"
        placeholder="Ask Claude about your code..."
      ></textarea>
    </mat-form-field>
    <button
      mat-fab
      extended
      color="primary"
      (click)="sendMessage()"
      [disabled]="!userInput().trim() || isStreaming() || !claudeAvailable()"
      class="send-button"
    >
      @if (isStreaming()) {
        <mat-spinner diameter="24"></mat-spinner>
      } @else {
        <mat-icon>send</mat-icon>
      }
      {{ isStreaming() ? 'Sending...' : 'Send' }}
    </button>
  </div>
</div>

